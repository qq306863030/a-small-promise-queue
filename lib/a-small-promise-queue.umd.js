!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).QueueTool={})}(this,(function(t){"use strict";function e(t,e,n,r){return new(n||(n=Promise))((function(s,i){function o(t){try{a(r.next(t))}catch(t){i(t)}}function u(t){try{a(r.throw(t))}catch(t){i(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,u)}a((r=r.apply(t,e||[])).next())}))}function n(t,e){var n,r,s,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=u(0),o.throw=u(1),o.return=u(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(u){return function(a){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(i=0)),i;)try{if(n=1,r&&(s=2&u[0]?r.return:u[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,u[1])).done)return s;switch(r=0,s&&(u=[2&u[0],s.value]),u[0]){case 0:case 1:s=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,r=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(!(s=i.trys,(s=s.length>0&&s[s.length-1])||6!==u[0]&&2!==u[0])){i=0;continue}if(3===u[0]&&(!s||u[1]>s[0]&&u[1]<s[3])){i.label=u[1];break}if(6===u[0]&&i.label<s[1]){i.label=s[1],s=u;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(u);break}s[2]&&i.ops.pop(),i.trys.pop();continue}u=e.call(t,i)}catch(t){u=[6,t],r=0}finally{n=s=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,a])}}}function r(t,e){return null==t||""===t?e:t}var s;"function"==typeof SuppressedError&&SuppressedError,function(t){t.READY="ready",t.RUNNING="running",t.PAUSE="pause",t.CLEAR="clear"}(s||(s={}));var i=function(){function t(t){this._tasks=[],this._runningTasks=[],this._maxConcurrenceCount=1,this._maxSize=-1,this._state=s.READY,this._maxConcurrenceCount=t.maxConcurrenceCount,this._maxSize=t.maxSize}return t.prototype.addTask=function(t){this._maxSize>=0&&this._tasks.length>=this._maxSize?console.error("Queue is full"):this._tasks.push(t)},t.prototype.setMaxSize=function(t){this._maxSize=t},t.prototype.getState=function(){return this._state},t.prototype.getTasks=function(){return this._tasks},t.prototype.getRunningTasks=function(){return this._runningTasks},t.prototype.start=function(t){this._setState(s.READY),this._runTask(t)},t.prototype.pause=function(){this._setState(s.PAUSE)},t.prototype.clear=function(){this._tasks.length=0,this._setState(s.CLEAR)},t.prototype._runTask=function(t){return e(this,void 0,void 0,(function(){var e;return n(this,(function(n){switch(n.label){case 0:if(this._state===s.PAUSE)return[2];if(!(e=this._getTask()))return[3,4];this._runningTasks.push(e),this._runningTasks.length<this._maxConcurrenceCount&&this._tasks.length>0&&this._runTask(t),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,e.fn()];case 2:return n.sent(),this._runningTasks.splice(this._runningTasks.indexOf(e),1),this._runningTasks.length<this._maxConcurrenceCount&&this._tasks.length>0?this._runTask(t):0===this._runningTasks.length&&0===this._tasks.length&&(this._state===s.RUNNING&&t&&t(),this._setState(s.READY)),[3,4];case 3:throw n.sent();case 4:return[2]}}))}))},t.prototype._getTask=function(){if(this._runningTasks.length<this._maxConcurrenceCount&&this._tasks.length>0)return this._setState(s.RUNNING),this._tasks.shift()},t.prototype._setState=function(t){this._state=t},t}(),o=function(){function t(t){void 0===t&&(t={}),this._isSkipError=!0,this._isAutoExecByAdd=!0,this._maxConcurrenceCount=1,this._timeout=-1,this._maxSize=-1,this._isSkipError=r(t.isSkipError,!0),this._isAutoExecByAdd=r(t.isAutoExecByAdd,!0),this._timeout=r(t.timeout,-1),this._maxSize=r(t.maxSize,-1),this._maxConcurrenceCount=r(t.maxConcurrenceCount,1),this._successCallBack=r(t.successCallBack,(function(){})),this._errorCallBack=r(t.errorCallBack,(function(){})),this._taskEndCallBack=t.taskEndCallBack,this._scheduler=new i({maxConcurrenceCount:this._maxConcurrenceCount,maxSize:this._maxSize})}return Object.defineProperty(t.prototype,"size",{get:function(){return this._scheduler.getTasks().length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"runningSize",{get:function(){return this._scheduler.getRunningTasks().length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxSize",{get:function(){return this._maxSize},set:function(t){this._maxSize=t,this._scheduler.setMaxSize(t)},enumerable:!1,configurable:!0}),t.prototype.add=function(t,e){var n=this;void 0===e&&(e={}),e.isSkipError=r(e.isSkipError,this._isSkipError),e.timeout=r(e.timeout,this._timeout),e.successCallBack=r(e.successCallBack,this._successCallBack),e.errorCallBack=r(e.errorCallBack,this._errorCallBack);var s={event:t,options:e,fn:function(){return n._exec(t,e)}};this._scheduler.addTask(s),this._isAutoExecByAdd&&this.start()},t.prototype.clear=function(){this._scheduler.clear()},t.prototype.pause=function(){this._scheduler.pause()},t.prototype.start=function(){this._scheduler.start(this._taskEndCallBack)},t.prototype._exec=function(t,r){var s=this;return void 0===r&&(r={}),new Promise((function(i,o){return e(s,void 0,void 0,(function(){var e,s,u,a,c,l;return n(this,(function(n){switch(n.label){case 0:s=(new Date).getTime(),u=this._scheduler.getState(),a={isTimeout:!1,isPaused:"pause"===u,schedulerState:u},r.timeout>0&&(e=setTimeout((function(){r.errorCallBack(new Error("Timeout")),r.isSkipError?(a.isTimeout=!0,i(!0)):o(new Error("Timeout"))}),r.timeout)),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,t(a)];case 2:return c=n.sent(),r.timeout?(new Date).getTime()-s<=r.timeout&&(e&&(clearTimeout(e),e=null),r.successCallBack(c),i(!0)):(r.successCallBack(c),i(!0)),[3,4];case 3:return l=n.sent(),r.errorCallBack(l),r.isSkipError?i(!0):o(l),[3,4];case 4:return[2]}}))}))}))},t}();t.PromiseQueue=o,t.SmallPromiseQueue=o,t.default=o,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=a-small-promise-queue.umd.js.map
